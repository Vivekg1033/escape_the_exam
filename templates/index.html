<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Escape the Exam - An endless runner game">
    <meta name="theme-color" content="#4CAF50">
    <title>Escape the Exam</title>
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" type="image/png" href="/static/icon-192.png">
    <link rel="stylesheet" href="/static/style.css">
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    {% if google_client_id %}
    <meta name="google-client-id" content="{{ google_client_id }}">
    <script>window.GOOGLE_CLIENT_ID = '{{ google_client_id }}';</script>
    {% endif %}
</head>
<body>
    <div id="game-container">
        <header>
            <h1>Escape the Exam</h1>
            <div class="score-display">
                <span>Score: <span id="score">0</span></span>
                <span>High Score: <span id="highScore">0</span></span>
            </div>
            <div class="account">
                <span id="playerNameDisplay" class="player-name-display"></span>
                <button id="signOutBtn" class="btn btn-small" style="display:none;margin-left:8px;">Sign Out</button>
            </div>
        </header>
        <div id="googleSignIn" class="google-signin"></div>
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <div class="controls">
            <button id="startBtn" class="btn btn-primary">Start Game</button>
            <button id="jumpBtn" class="btn btn-secondary">Jump (Space)</button>
            <button id="pauseBtn" class="btn btn-secondary">Pause</button>
        </div>
        <div id="gameOverModal" class="modal hidden">
            <div class="modal-content">
                <span id="closeScoreModalBtn" style="cursor:pointer;float:right;font-size:24px">&times;</span>
                <h2>Game Over!</h2>
                <p>Your Score: <span id="finalScore">0</span></p>
                <input type="text" id="playerName" placeholder="Enter your name" maxlength="50">
                <button id="saveScoreBtn" class="btn btn-primary">Save Score</button>
                <button id="retryBtn" class="btn btn-secondary">Try Again</button>
                <p id="saveMessage" class="save-message"></p>
            </div>
        </div>

        <!-- Account Modal -->
        <!-- Account Modal removed -->
        <div class="leaderboard">
            <h2>Leaderboard</h2>
            <button id="refreshLeaderboard" class="btn btn-small">Refresh</button>
            <div id="leaderboardList" class="leaderboard-list">
                <p>Loading...</p>
            </div>
        </div>
        <div class="instructions">
            <h3>How to Play:</h3>
            <ul>
                <li>Press <strong>SPACE</strong> or tap <strong>Jump</strong> to jump</li>
                <li>Avoid obstacles (books, coffee, assignments)</li>
                <li>Collect snacks for bonus points</li>
                <li>Survive as long as you can!</li>
            </ul>
        </div>
    </div>
    <script src="/static/game.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
